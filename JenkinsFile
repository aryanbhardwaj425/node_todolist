pipeline {
    agent any
    
    stages {
        stage('Checkout SCM') {
            steps {
                checkout scm
            }
        }

        stage('Install Node.js and npm') {
            steps {
                script {
                    // Check the user running the script
                    sh 'echo "Running as user: $(whoami)"'

                    // Ensure the necessary dependencies and Node.js are installed with sudo privileges
                    sh '''
                    if [ "$(whoami)" != "root" ]; then
                        echo "Running npm installation with sudo privileges"
                        sudo apt-get update -y
                        sudo apt-get install -y nodejs npm
                    else
                        echo "Running as root, installing npm"
                        apt-get update -y
                        apt-get install -y nodejs npm
                    fi
                    '''
                }
            }
        }

        stage('Build') {
            steps {
                // Build steps (e.g., running npm install or other build commands)
                sh 'npm install'
            }
        }
    }

    post {
        always {
            echo 'Pipeline finished'
        }
    }
}
